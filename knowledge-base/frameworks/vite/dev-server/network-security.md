# Vite å¼€å‘æœåŠ¡å™¨ç½‘ç»œå®‰å…¨

## ğŸ“‹ æ¦‚è¿°

Vite å¼€å‘æœåŠ¡å™¨çš„ç½‘ç»œå®‰å…¨æ˜¯ç¡®ä¿å¼€å‘ç¯å¢ƒå®‰å…¨çš„é‡è¦æ–¹é¢ã€‚æ­£ç¡®çš„ç½‘ç»œå®‰å…¨é…ç½®å¯ä»¥é˜²æ­¢ç½‘ç»œæ”»å‡»ã€æ•°æ®æ³„éœ²ç­‰å®‰å…¨é—®é¢˜ã€‚

## ğŸ¯ æ ¸å¿ƒå®‰å…¨ç‰¹æ€§

- **HTTPS æ”¯æŒ**ï¼šVite å¼€å‘æœåŠ¡å™¨æ”¯æŒ HTTPSï¼Œæä¾›å®‰å…¨çš„ç½‘ç»œä¼ è¾“
- **ä»£ç†å®‰å…¨**ï¼šVite æä¾›äº†å®‰å…¨çš„ä»£ç†é…ç½®ï¼Œå¯ä»¥å®‰å…¨åœ°è½¬å‘è¯·æ±‚
- **CORS æ§åˆ¶**ï¼šVite æä¾›äº† CORS é…ç½®ï¼Œæ§åˆ¶è·¨åŸŸè®¿é—®
- **è¯·æ±‚å¤´å®‰å…¨**ï¼šVite å…è®¸é…ç½®è‡ªå®šä¹‰è¯·æ±‚å¤´ï¼Œå¢å¼ºå®‰å…¨æ€§

## ğŸ” å¸¸è§å®‰å…¨é—®é¢˜

### é—®é¢˜ 1ï¼šä¸­é—´äººæ”»å‡»

**æè¿°**ï¼šå¦‚æœå¼€å‘æœåŠ¡å™¨æœªå¯ç”¨ HTTPSï¼Œæ”»å‡»è€…å¯èƒ½æ‰§è¡Œä¸­é—´äººæ”»å‡»ï¼Œæ‹¦æˆªå’Œç¯¡æ”¹ç½‘ç»œæµé‡ã€‚

**é£é™©**ï¼šé«˜é£é™©ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²ï¼Œä¼šè¯åŠ«æŒç­‰ä¸¥é‡åæœã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **å¯ç”¨ HTTPS**ï¼šåœ¨å¼€å‘æœåŠ¡å™¨é…ç½®ä¸­å¯ç”¨ HTTPS
2. **ä½¿ç”¨å¼ºåŠ å¯†**ï¼šä½¿ç”¨å¼ºåŠ å¯†ç®—æ³•å’Œå¯†é’¥é•¿åº¦
3. **éªŒè¯è¯ä¹¦**ï¼šéªŒè¯ SSL/TLS è¯ä¹¦çš„æœ‰æ•ˆæ€§

```javascript
// vite.config.js
import fs from 'fs';
import path from 'path';

export default {
  server: {
    // å¯ç”¨ HTTPS
    https: {
      key: fs.readFileSync(path.resolve(__dirname, 'certs/key.pem')),
      cert: fs.readFileSync(path.resolve(__dirname, 'certs/cert.pem'))
    }
  }
};
```

### é—®é¢˜ 2ï¼šDNS åŠ«æŒ

**æè¿°**ï¼šå¦‚æœ DNS æŸ¥è¯¢è¢«åŠ«æŒï¼Œç”¨æˆ·å¯èƒ½è¢«é‡å®šå‘åˆ°æ¶æ„æœåŠ¡å™¨ã€‚

**é£é™©**ï¼šä¸­é£é™©ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²ï¼Œé’“é±¼æ”»å‡»ç­‰åæœã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **ä½¿ç”¨ DNSSEC**ï¼šä½¿ç”¨ DNSSEC éªŒè¯ DNS æŸ¥è¯¢
2. **ä½¿ç”¨å¯ä¿¡ DNS æœåŠ¡å™¨**ï¼šä½¿ç”¨å¯ä¿¡çš„ DNS æœåŠ¡å™¨
3. **éªŒè¯ DNS è§£æ**ï¼šåœ¨åº”ç”¨ä¸­éªŒè¯ DNS è§£æç»“æœ

```javascript
// utils/dns.js
export const verifyDnsResolution = async (hostname) => {
  // è·å– DNS è§£æç»“æœ
  const response = await fetch(`https://dns.google/resolve?name=${hostname}&type=A`);
  const data = await response.json();
  
  // éªŒè¯ DNS è§£æç»“æœ
  if (!data.Answer || data.Answer.length === 0) {
    console.warn('DNS è§£æå¤±è´¥');
    return false;
  }
  
  // è¿”å› DNS è§£æç»“æœ
  return data.Answer[0].data;
};
```

### é—®é¢˜ 3ï¼šç½‘ç»œå—…æ¢

**æè¿°**ï¼šå¦‚æœç½‘ç»œæµé‡æœªåŠ å¯†ï¼Œæ”»å‡»è€…å¯èƒ½å—…æ¢ç½‘ç»œæµé‡ï¼Œè·å–æ•æ„Ÿä¿¡æ¯ã€‚

**é£é™©**ï¼šä¸­é£é™©ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²ï¼Œç”¨æˆ·éšç§å—æŸç­‰åæœã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **å¯ç”¨ HTTPS**ï¼šåœ¨å¼€å‘æœåŠ¡å™¨ä¸­å¯ç”¨ HTTPSï¼ŒåŠ å¯†ç½‘ç»œæµé‡
2. **ä½¿ç”¨ HSTS**ï¼šä½¿ç”¨ HTTP ä¸¥æ ¼ä¼ è¾“å®‰å…¨ (HSTS) å¼ºåˆ¶ HTTPS
3. **é¿å…æ··åˆå†…å®¹**ï¼šé¿å…åœ¨ HTTPS é¡µé¢ä¸­åŠ è½½ HTTP èµ„æº

```javascript
// vite.config.js
export default {
  server: {
    // å¯ç”¨ HTTPS
    https: {
      key: fs.readFileSync(path.resolve(__dirname, 'certs/key.pem')),
      cert: fs.readFileSync(path.resolve(__dirname, 'certs/cert.pem'))
    },
    // é…ç½®å®‰å…¨å¤´
    headers: {
      'Strict-Transport-Security': 'max-age=31536000; includeSubDomains'
    }
  }
};
```

### é—®é¢˜ 4ï¼šç«¯å£æ‰«æ

**æè¿°**ï¼šå¦‚æœå¼€å‘æœåŠ¡å™¨æš´éœ²åˆ°å…¬ç½‘ï¼Œæ”»å‡»è€…å¯èƒ½æ‰«æå¼€æ”¾ç«¯å£ï¼Œå‘ç°å®‰å…¨æ¼æ´ã€‚

**é£é™©**ï¼šä¸­é£é™©ï¼Œå¯èƒ½å¯¼è‡´æœªæˆæƒè®¿é—®ï¼Œæ•°æ®æ³„éœ²ç­‰åæœã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **é™åˆ¶ç›‘å¬åœ°å€**ï¼šé…ç½®å¼€å‘æœåŠ¡å™¨åªç›‘å¬æœ¬åœ°åœ°å€
2. **ä½¿ç”¨é˜²ç«å¢™**ï¼šä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹å¼€å‘æœåŠ¡å™¨çš„è®¿é—®
3. **ç›‘æ§ç«¯å£è®¿é—®**ï¼šç›‘æ§ç«¯å£è®¿é—®æ—¥å¿—ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸è®¿é—®

```javascript
// vite.config.js
export default {
  server: {
    // åªç›‘å¬æœ¬åœ°åœ°å€
    host: 'localhost',
    // æˆ–ä½¿ç”¨ 127.0.0.1
    // host: '127.0.0.1'
  }
};
```

## ğŸ› ï¸ å®‰å…¨é…ç½®

### æ¨èé…ç½®

```javascript
// vite.config.js
import fs from 'fs';
import path from 'path';

export default {
  server: {
    // å¯ç”¨ HTTPS
    https: {
      key: fs.readFileSync(path.resolve(__dirname, 'certs/key.pem')),
      cert: fs.readFileSync(path.resolve(__dirname, 'certs/cert.pem'))
    },
    // åªç›‘å¬æœ¬åœ°åœ°å€
    host: 'localhost',
    // é…ç½®å®‰å…¨å¤´
    headers: {
      'Strict-Transport-Security': 'max-age=31536000; includeSubDomains',
      'X-Content-Type-Options': 'nosniff',
      'X-Frame-Options': 'SAMEORIGIN',
      'X-XSS-Protection': '1; mode=block'
    }
  }
};
```

### å®‰å…¨æ£€æŸ¥æ¸…å•

- [x] å¯ç”¨ HTTPSï¼Œä½¿ç”¨å¼ºåŠ å¯†ç®—æ³•å’Œå¯†é’¥é•¿åº¦
- [x] éªŒè¯ SSL/TLS è¯ä¹¦çš„æœ‰æ•ˆæ€§
- [x] ä½¿ç”¨ DNSSEC éªŒè¯ DNS æŸ¥è¯¢
- [x] ä½¿ç”¨å¯ä¿¡çš„ DNS æœåŠ¡å™¨
- [x] å¯ç”¨ HSTSï¼Œå¼ºåˆ¶ HTTPS
- [x] é¿å…æ··åˆå†…å®¹
- [x] é™åˆ¶å¼€å‘æœåŠ¡å™¨åªç›‘å¬æœ¬åœ°åœ°å€
- [x] ä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹å¼€å‘æœåŠ¡å™¨çš„è®¿é—®
- [x] ç›‘æ§ç«¯å£è®¿é—®æ—¥å¿—
- [x] é…ç½®å®‰å…¨å¤´ï¼Œå¢å¼ºå®‰å…¨æ€§

## ğŸ“š æœ€ä½³å®è·µ

1. **å¯ç”¨ HTTPS**ï¼šåœ¨å¼€å‘æœåŠ¡å™¨ä¸­å¯ç”¨ HTTPSï¼ŒåŠ å¯†ç½‘ç»œæµé‡
2. **ä½¿ç”¨å¼ºåŠ å¯†**ï¼šä½¿ç”¨å¼ºåŠ å¯†ç®—æ³•å’Œå¯†é’¥é•¿åº¦
3. **ä½¿ç”¨ HSTS**ï¼šä½¿ç”¨ HTTP ä¸¥æ ¼ä¼ è¾“å®‰å…¨ (HSTS) å¼ºåˆ¶ HTTPS
4. **é¿å…æ··åˆå†…å®¹**ï¼šé¿å…åœ¨ HTTPS é¡µé¢ä¸­åŠ è½½ HTTP èµ„æº
5. **é™åˆ¶ç›‘å¬åœ°å€**ï¼šé…ç½®å¼€å‘æœåŠ¡å™¨åªç›‘å¬æœ¬åœ°åœ°å€
6. **ä½¿ç”¨é˜²ç«å¢™**ï¼šä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹å¼€å‘æœåŠ¡å™¨çš„è®¿é—®
7. **ç›‘æ§ç½‘ç»œæµé‡**ï¼šç›‘æ§ç½‘ç»œæµé‡ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸è¡Œä¸º
8. **å®šæœŸæ›´æ–°**ï¼šå®šæœŸæ›´æ–° Vite å’Œç›¸å…³ä¾èµ–ï¼Œä¿®å¤å·²çŸ¥å®‰å…¨æ¼æ´

## ğŸ“ å®‰å…¨èµ„æº

- [Vite å®˜æ–¹æ–‡æ¡£ - å¼€å‘æœåŠ¡å™¨](https://vitejs.dev/config/server-options.html)
- [OWASP ç½‘ç»œå®‰å…¨å¤‡å¿˜å•](https://cheatsheetseries.owasp.org/cheatsheets/Network_Security_Cheat_Sheet.html)
- [OWASP TLS é…ç½®å¤‡å¿˜å•](https://cheatsheetseries.owasp.org/cheatsheets/Transport_Layer_Protection_Cheat_Sheet.html)
- [Mozilla å®‰å…¨å¤´æŒ‡å—](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)

## ğŸ“ æ›´æ–°æ—¥å¿—

- 2024-01-01ï¼šåˆå§‹ç‰ˆæœ¬ï¼Œæ·»åŠ å¼€å‘æœåŠ¡å™¨ç½‘ç»œå®‰å…¨æŒ‡å—
- 2024-02-15ï¼šæ›´æ–° Vite 5.x ç½‘ç»œå®‰å…¨ç‰¹æ€§
- 2024-03-20ï¼šæ·»åŠ æ›´å¤šå®‰å…¨é…ç½®ç¤ºä¾‹å’Œæœ€ä½³å®è·µ