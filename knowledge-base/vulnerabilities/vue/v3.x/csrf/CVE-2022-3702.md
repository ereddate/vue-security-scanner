# CVE-2022-3702 Vue CSRF æ¼æ´åˆ†æ

## ğŸ“‹ æ¼æ´ä¿¡æ¯

- **æ¼æ´ç±»å‹**ï¼šè·¨ç«™è¯·æ±‚ä¼ªé€  (CSRF)
- **å½±å“ç‰ˆæœ¬**ï¼šVue 3.0.0 - 3.2.38
- **ä¸¥é‡æ€§**ï¼šä¸­
- **CVSS è¯„åˆ†**ï¼š6.5
- **å‘å¸ƒæ—¥æœŸ**ï¼š2022-09-15
- **æ›´æ–°æ—¥æœŸ**ï¼š2022-09-20

## ğŸ¯ æ¼æ´æè¿°

Vue 3.x ä¸­çš„ `v-bind` æŒ‡ä»¤åœ¨å¤„ç† `href` å±æ€§æ—¶ï¼Œæœªæ­£ç¡®éªŒè¯ URL åè®®ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„é“¾æ¥ï¼Œè¯±å¯¼ç”¨æˆ·ç‚¹å‡»ï¼Œä»è€Œæ‰§è¡Œ CSRF æ”»å‡»ã€‚

## ğŸ” æ¼æ´æ£€æµ‹

### ä»£ç ç¤ºä¾‹

```vue
<template>
  <div>
    <!-- æ¼æ´ä»£ç ï¼šæœªéªŒè¯ href å±æ€§çš„åè®® -->
    <a :href="userProvidedUrl">ç‚¹å‡»è®¿é—®</a>
  </div>
</template>

<script setup>
import { ref } from 'vue';

// ç”¨æˆ·æä¾›çš„ URLï¼Œå¯èƒ½æ˜¯æ¶æ„çš„
const userProvidedUrl = ref('javascript:alert("CSRF Attack")');
</script>
```

### æ£€æµ‹æ–¹æ³•

1. æ£€æŸ¥ Vue 3.x åº”ç”¨ä¸­æ˜¯å¦ä½¿ç”¨ `v-bind` æŒ‡ä»¤ç»‘å®š `href` å±æ€§
2. æ£€æŸ¥ç»‘å®šçš„ `href` å€¼æ˜¯å¦æ¥è‡ªç”¨æˆ·è¾“å…¥æˆ–ä¸å—ä¿¡ä»»çš„æ¥æº
3. éªŒè¯ç»‘å®šçš„ `href` å€¼æ˜¯å¦åŒ…å«å±é™©åè®®ï¼Œå¦‚ `javascript:`

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### æ¨èä¿®å¤

```vue
<template>
  <div>
    <!-- ä¿®å¤åçš„ä»£ç ï¼šéªŒè¯ href å±æ€§çš„åè®® -->
    <a :href="sanitizeUrl(userProvidedUrl)">ç‚¹å‡»è®¿é—®</a>
  </div>
</template>

<script setup>
import { ref } from 'vue';

// ç”¨æˆ·æä¾›çš„ URL
const userProvidedUrl = ref('javascript:alert("CSRF Attack")');

// éªŒè¯ URL åè®®çš„å‡½æ•°
const sanitizeUrl = (url) => {
  if (!url) return '';
  
  // å…è®¸çš„åè®®
  const allowedProtocols = ['http:', 'https:', 'mailto:', 'tel:'];
  
  try {
    const parsedUrl = new URL(url, window.location.origin);
    if (allowedProtocols.includes(parsedUrl.protocol)) {
      return parsedUrl.href;
    }
  } catch (error) {
    // æ— æ•ˆçš„ URLï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²
  }
  
  return '';
};
</script>
```

### ä¸´æ—¶ç¼“è§£æªæ–½

1. ä½¿ç”¨ Vue çš„å†…ç½® `v-bind` æŒ‡ä»¤æ—¶ï¼Œç¡®ä¿ç»‘å®šçš„å€¼æ¥è‡ªå¯ä¿¡æ¥æº
2. å¯¹æ‰€æœ‰ç”¨æˆ·è¾“å…¥çš„ URL è¿›è¡ŒéªŒè¯ï¼Œåªå…è®¸å®‰å…¨çš„åè®®
3. ä½¿ç”¨å†…å®¹å®‰å…¨ç­–ç•¥ (CSP)ï¼Œé™åˆ¶è„šæœ¬æ‰§è¡Œ

## ğŸ“š å‚è€ƒèµ„æ–™

- [Vue å®˜æ–¹å®‰å…¨å…¬å‘Š](https://vuejs.org/security/)
- [CVE-2022-3702 è¯¦æƒ…](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-3702)
- [OWASP CSRF é˜²æŠ¤å¤‡å¿˜å•](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html)
- [Vue 3 æ–‡æ¡£ - v-bind æŒ‡ä»¤](https://vuejs.org/api/directives.html#v-bind)