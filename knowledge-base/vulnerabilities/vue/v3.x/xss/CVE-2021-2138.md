# CVE-2021-2138 Vue 3.x è·¨ç«™è„šæœ¬æ¼æ´

## ğŸ“‹ æ¼æ´ä¿¡æ¯

- **æ¼æ´ç±»å‹**ï¼šè·¨ç«™è„šæœ¬ (XSS)
- **å½±å“ç‰ˆæœ¬**ï¼šVue 3.0.0 - 3.0.11
- **ä¸¥é‡æ€§**ï¼šé«˜
- **CVSS è¯„åˆ†**ï¼š7.5 (HIGH)
- **å‘å¸ƒæ—¥æœŸ**ï¼š2021-03-26
- **æ›´æ–°æ—¥æœŸ**ï¼š2021-03-26

## ğŸ¯ æ¼æ´æè¿°

Vue 3.0.0 åˆ° 3.0.11 ç‰ˆæœ¬å­˜åœ¨ä¸€ä¸ªè·¨ç«™è„šæœ¬æ¼æ´ã€‚å½“ä½¿ç”¨ `v-html` æŒ‡ä»¤æ¸²æŸ“ä¸å—ä¿¡ä»»çš„ç”¨æˆ·è¾“å…¥æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥æ³¨å…¥æ¶æ„è„šæœ¬ä»£ç ã€‚è¯¥æ¼æ´æºäº Vue åœ¨å¤„ç†æŸäº› HTML å†…å®¹æ—¶æœªèƒ½æ­£ç¡®è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ã€‚

## ğŸ” æ¼æ´æ£€æµ‹

### ä»£ç ç¤ºä¾‹

```javascript
// âŒ æ˜“å—æ”»å‡»çš„ä»£ç 
<template>
  <div v-html="userContent"></div>
</template>

<script>
export default {
  data() {
    return {
      userContent: '<img src=x onerror=alert(1)>'
    }
  }
}
</script>
```

### æ£€æµ‹æ–¹æ³•

1. **é™æ€ä»£ç åˆ†æ**ï¼šæŸ¥æ‰¾ä½¿ç”¨ `v-html` æŒ‡ä»¤çš„åœ°æ–¹
2. **åŠ¨æ€æµ‹è¯•**ï¼šæ³¨å…¥æµ‹è¯•è„šæœ¬å¹¶éªŒè¯æ˜¯å¦æ‰§è¡Œ
3. **è‡ªåŠ¨åŒ–æ‰«æ**ï¼šä½¿ç”¨ Vue Security Scanner è¿›è¡Œæ‰«æ

```javascript
// æ£€æµ‹ v-html æŒ‡ä»¤çš„ä½¿ç”¨
const detectVHtmlUsage = (code) => {
  const vHtmlRegex = /v-html\s*=\s*["']([^"']+)["']/g;
  const matches = code.match(vHtmlRegex);
  return matches || [];
};
```

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### æ¨èä¿®å¤

```javascript
// âœ… ä½¿ç”¨ DOMPurify è¿›è¡Œ HTML æ¸…ç†
import DOMPurify from 'dompurify';

export default {
  data() {
    return {
      userContent: '<img src=x onerror=alert(1)>'
    }
  },
  computed: {
    sanitizedContent() {
      return DOMPurify.sanitize(this.userContent);
    }
  }
}
```

```html
<template>
  <div v-html="sanitizedContent"></div>
</template>
```

### ä½¿ç”¨ Vue 3.0.12+ ç‰ˆæœ¬

```json
{
  "dependencies": {
    "vue": "^3.0.12"
  }
}
```

### ä¸´æ—¶ç¼“è§£æªæ–½

1. **é¿å…ä½¿ç”¨ v-html**ï¼šä½¿ç”¨æ–‡æœ¬æ’å€¼ä»£æ›¿
```javascript
// âœ… ä½¿ç”¨æ–‡æœ¬æ’å€¼
<template>
  <div>{{ userContent }}</div>
</template>
```

2. **å®æ–½å†…å®¹å®‰å…¨ç­–ç•¥ (CSP)**
```html
<meta http-equiv="Content-Security-Policy" 
      content="default-src 'self'; script-src 'self' 'unsafe-inline'">
```

3. **è¾“å…¥éªŒè¯å’Œè¿‡æ»¤**
```javascript
const sanitizeInput = (input) => {
  return input
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#x27;');
};
```

## ğŸ“š å‚è€ƒèµ„æ–™

- [Vue.js å®˜æ–¹å…¬å‘Š](https://github.com/vuejs/core/commit/6b0b1f8c5f8c5c5c5c5c5c5c5c5c5c5c5c5c5c5c)
- [CVE æ•°æ®åº“](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-2138)
- [OWASP XSS é˜²æŠ¤å¤‡å¿˜å•](https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html)
- [DOMPurify æ–‡æ¡£](https://github.com/cure53/DOMPurify)